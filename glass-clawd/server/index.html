<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=640, initial-scale=1.0, user-scalable=no">
<title>Glass Clawd</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    background: #1a1a1a;
    color: #e0e0e0;
    font-family: sans-serif;
    font-size: 18px;
    height: 360px;
    overflow: hidden;
}
#chat {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 56px;
    overflow-y: auto;
    padding: 8px;
    -webkit-overflow-scrolling: touch;
}
.msg {
    margin-bottom: 8px;
    padding: 8px 12px;
    border-radius: 8px;
    max-width: 90%;
    word-wrap: break-word;
    line-height: 1.4;
}
.msg.user {
    background: #2d5a8a;
    margin-left: auto;
    text-align: right;
}
.msg.assistant {
    background: #333;
}
.msg.error {
    background: #5a2d2d;
    color: #ff9999;
}
.msg .role {
    font-size: 11px;
    color: #999;
    margin-bottom: 2px;
}
.msg.user .role { color: #88bbee; }
.msg.assistant .role { color: #D97757; }
#bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 56px;
    background: #222;
    border-top: 1px solid #444;
    padding: 6px 8px;
}
#input {
    width: 100%;
    height: 100%;
    background: #333;
    color: #e0e0e0;
    border: 1px solid #555;
    border-radius: 6px;
    padding: 0 12px;
    font-size: 18px;
    outline: none;
}
#input:focus { border-color: #D97757; }
#status {
    position: absolute;
    bottom: 62px;
    right: 8px;
    background: #D97757;
    color: #fff;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 13px;
    display: none;
}
.typing {
    color: #999;
    font-style: italic;
    padding: 8px 12px;
}
</style>
</head>
<body>

<div id="chat"></div>
<div id="status"></div>
<div id="bar">
    <input id="input" type="text" placeholder="Type or tap to speak..." autocomplete="off">
</div>

<script>
var chatEl = document.getElementById('chat');
var inputEl = document.getElementById('input');
var statusEl = document.getElementById('status');
var sending = false;

function scrollBottom() {
    chatEl.scrollTop = chatEl.scrollHeight;
}

function addMessage(role, text) {
    var div = document.createElement('div');
    div.className = 'msg ' + role;
    var roleLabel = document.createElement('div');
    roleLabel.className = 'role';
    roleLabel.textContent = role === 'user' ? 'You' : 'Claude';
    div.appendChild(roleLabel);
    var content = document.createElement('div');
    content.textContent = text;
    div.appendChild(content);
    chatEl.appendChild(div);
    scrollBottom();
}

function showStatus(text) {
    statusEl.textContent = text;
    statusEl.style.display = 'block';
}

function hideStatus() {
    statusEl.style.display = 'none';
}

function sendMessage(text) {
    if (sending || !text) return;
    sending = true;
    addMessage('user', text);
    inputEl.value = '';
    showStatus('Thinking...');

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/chat', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onreadystatechange = function() {
        if (xhr.readyState !== 4) return;
        hideStatus();
        sending = false;
        try {
            var data = JSON.parse(xhr.responseText);
            if (xhr.status === 200 && data.reply) {
                addMessage('assistant', data.reply);
            } else {
                addMessage('error', 'Error: ' + (data.error || 'Unknown error'));
            }
        } catch (e) {
            addMessage('error', 'Error: ' + xhr.statusText);
        }
    };
    xhr.send(JSON.stringify({ message: text }));
}

// Submit on Enter key
inputEl.addEventListener('keydown', function(e) {
    if (e.keyCode === 13) {
        e.preventDefault();
        sendMessage(inputEl.value.trim());
    }
});

// Load existing conversation on page load
var hxhr = new XMLHttpRequest();
hxhr.open('GET', '/history', true);
hxhr.onreadystatechange = function() {
    if (hxhr.readyState !== 4 || hxhr.status !== 200) return;
    try {
        var data = JSON.parse(hxhr.responseText);
        var msgs = data.messages || [];
        for (var i = 0; i < msgs.length; i++) {
            addMessage(msgs[i].role, msgs[i].content);
        }
    } catch(e) {}
};
hxhr.send();

// Auto-focus the input
inputEl.focus();
</script>

</body>
</html>
